template:
  inputs:
    connector:
      type: connector
      label: Jira Connector
      required: true
      oneof:
        - Jira
      ui:
        tooltip: Select the Jira connector for authentication
        allowedValueTypes:
          - fixed
          - runtime
          - expression
    issue:
      type: string
      label: Issue Key
      required: true
      ui:
        tooltip: Enter the Jira issue key to monitor for approval
        placeholder: Enter issue key
    retry:
      type: string
      label: Retry interval
      default: 1m
      ui:
        tooltip: Specify the interval between retry attempts for checking approval status
        placeholder: Enter retry interval
    approve:
      type: string
      label: Approve Criteria
      ui:
        tooltip: Define the conditions or expression that will approve the deployment
        placeholder: Enter conditions or expression
    reject:
      type: string
      label: Reject Criteria
      ui:
        tooltip: Define the conditions or expression that will reject the deployment
        placeholder: Enter conditions or expression
    log_level:
      type: string
      label: Log level
      default: error
      options:
        - info
        - warn
        - error
        - debug
        - trace
      ui:
        component: select
        tooltip: Set the log level for the plugin.

  layout:
    - connector
    - issue
    - retry
    - title: Approve Criteria
      items:
      - approve
    - title: Optional Configuration
      items:
      - title: Reject Criteria
        items:
        - reject
    - log_level
  id: jira_approval
  name: Jira Approval
  description: Approve or reject using a Jira issue
  version: 1
  author: harness
  module:
    - cd
  alias: jira-approval
  step:
    group:
      steps:
        - approval:
          uses: jira
          with:
            retry: ${{inputs.retry}}
            run:
              download:
                source: https://storage.googleapis.com/unified-plugins/jira-approval/v0.0.1/
                target: $PLUGIN_PATH
              script: $PLUGIN_PATH
              env:
                PLUGIN_HARNESS_CONNECTOR: ${{inputs.connector.id}}
                PLUGIN_LOG_LEVEL: ${{inputs.log_level}}
                PLUGIN_ISSUE_KEY: ${{inputs.issue}}
            approve: ${{inputs.approve}}
            reject: ${{inputs.reject}}
