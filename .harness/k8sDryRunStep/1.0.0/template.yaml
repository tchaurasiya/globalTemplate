template:
  inputs:
    kubeconfig:
      type: string
      label: Kubeconfig Path
      default: ${{infra.PLUGIN_HARNESS_KUBE_CONFIG_PATH}}
      ui:
        tooltip: The path to the 'kubeconfig' file
    namespace:
      type: string
      label: Namespace
      default: ${{infra.namespace}}
      ui:
        tooltip: Kubernetes namespace for deployment
    manifests:
      type: array
      label: Manifest Path
      default: ${{runtime.manifestPath}}
      ui:
        component: array
        input:
          inputType: text
        tooltip: List of manifest file paths
    encrypt_yaml_output:
      type: boolean
      label: Encrypt YAML Output
      default: false
      ui:
        component: boolean-card-select
        tooltip: Encrypt the output YAML file
    flags:
      type: array
      label: Command Flags
      ui:
        component: list
        layout: grid
        inputs:
          - inputType: select
            relativePath: commandType
            label: Command Type
            inputConfig:
              options:
                - label: Apply
                  value: Apply
          - inputType: textarea
            relativePath: flag
            label: Flag
            ui:
              placeholder: --warnings-as-errors
    timeout:
      type: string
      label: Timeout
      default: 5m
      ui:
        tooltip: Timeout to use during Apply/DryRun command execution
    log_level:
      type: string
      label: Log Level
      default: info
      options:
        - warn
        - error
        - info
        - debug
        - trace
      ui:
        component: select
        tooltip: Select the log level for this step
  layout:
    - title: Optional Configuration
      items:
        - kubeconfig
        - manifests
        - namespace
        - flags
        - timeout
        - log_level
        - encrypt_yaml_output
  id: k8sDryRunStep
  name: Kubernetes Dry Run
  description: Performs a dry run of the manifests to the Kubernetes cluster
  version: 1
  author: harness
  module:
    - cd
  alias: deploy
  step:
    name:
    id:
    run:
      container:
        image: harnessdev/k8s-apply:0.0.1
        connector: account.harnessImage
      env:
        PLUGIN_KUBECONFIG_PATH: ${{inputs.kubeconfig}}
        PLUGIN_NAMESPACE: ${{inputs.namespace}}
        PLUGIN_MANIFEST_PATH: ${{inputs.manifests}}
        PLUGIN_ENCRYPT_YAML_OUTPUT: ${{inputs.encrypt_yaml_output}}
        PLUGIN_FLAGS_JSON: ${{json.format(${{inputs.flags}})}}
        PLUGIN_LOG_LEVEL: ${{inputs.log_level}}
        PLUGIN_TIMEOUT: ${{inputs.apply_timeout}}