template:
  inputs:
    kubeconfig:
      type: string
      label: Kubeconfig Path
      default: ${{infra.PLUGIN_HARNESS_KUBE_CONFIG_PATH}}
      ui:
        tooltip: Specify the path to the 'kubeconfig' file.
    namespace:
      type: string
      label: Namespace
      default: ${{infra.namespace}}
      ui:
        tooltip: Specify the Kubernetes namespace for deployment
    release:
      type: string
      label: Release Name
      default: ${{infra.release}}
      ui:
        tooltip: Specify the name for the current Harness release
    release_number:
      type: number
      label: Release Number
      default: 0
      ui:
        component: number
        tooltip: Specify the release number for tracking
    service_id:
      type: string
      label: Service ID
      default: ${{service.identifier}}
      ui:
        tooltip: Specify the service ID for release
    environment_id:
      type: string
      label: Environment ID
      default: ${{env.identifier}}
      ui:
        tooltip: Specify the environment ID for release
    infra_id:
      type: string
      label: Infrastructure ID
      default: ${{infra.identifier}}
      ui:
        tooltip: Specify the infrastructure ID for release
    infra_key:
      type: string
      label: Infrastructure Key
      default: ${{infra.infrastructureKey}}
      ui:
        tooltip: Specify the infrastructure key for release
    manifest:
      type: string
      label: Manifest Path
      ui:
        tooltip: Specify the path to rendered manifest(s)
        placeholder: path/manifest
    describe_resources:
      type: boolean
      label: Describe Resources
      default: false
      ui:
        component: boolean-card-select
        tooltip: Flag to describe resources during the steady state check
    existing_pods:
      type: array
      label: Existing Pods
      ui:
        component: array
        input: 
          inputType: text
        tooltip: Enter a list of existing pods to monitor
        placeholder: pod-name
    custom_workloads:
      type: array
      label: Custom Workloads
      ui:
        component: array
        input: 
          inputType: text
        tooltip: Enter a list of custom workloads to perform steady check on
        placeholder: [ns/kind/workload-name,ns/kind/workload-name-2]
    managed_workloads:
      type: array
      label: Managed Workloads
      ui:
        component: array
        input: 
          inputType: text
        tooltip: Enter a list of managed workloads to perform steady check on
        placeholder: [ns/kind/workload-name,ns/kind/workload-name-2]
    log_level:
      type: string
      label: Log Level
      default: info
      options:
        - warn
        - error
        - info
        - debug
        - trace
      ui:
        component: select
        tooltip: Select the log level for the plugin
    timeout:
      type: string
      label: Steady State command timeout
      default: 5m
      ui:
        tooltip: Specify the timeout to use during steady state command execution
    is_openshift:
      type: boolean
      label: OpenShift Mode
      default: false
      ui:
        component: boolean-card-select
        tooltip: Flag to mark if this is OpenShift deployment
  layout:
    - kubeconfig
    - title: Optional Configuration
      items:
        - namespace
        - title: Resource Configuration
          items:
            - manifest
            - custom_workloads
            - managed_workloads
            - existing_pods
            - describe_resources
        - title: Release Configuration
          items:
            - release
            - release_number
            - service_id
            - environment_id
            - infra_id
            - infra_key
        - log_level
        - timeout
        - is_openshift
  id: k8sSteadyStateCheckStep
  name: Kubernetes Steady State Check
  description: Checks the steady state of the workload
  version: 1
  author: harness
  module:
    - cd
  alias: deploy
  step:
    name: Kubernetes Steady State Check
    id: k8sSteadyStateCheckStep
    run:
      container:
        image: harnessdev/k8s-steady-check:0.0.1
        connector: account.harnessImage
      env:
        PLUGIN_KUBECONFIG_PATH: ${{inputs.kubeconfig}}
        PLUGIN_RELEASE_NAME: ${{inputs.release}}
        PLUGIN_RELEASE_NUMBER: ${{inputs.release_number}}
        PLUGIN_SERVICE_ID: ${{inputs.service_id}}
        PLUGIN_ENVIRONMENT_ID: ${{inputs.environment_id}}
        PLUGIN_INFRA_ID: ${{inputs.infra_id}}
        PLUGIN_INFRA_KEY: ${{inputs.infra_key}}
        PLUGIN_NAMESPACE: ${{inputs.namespace}}
        PLUGIN_DESCRIBE_RESOURCES: ${{inputs.describe_resources}}
        PLUGIN_MANAGED_WORKLOADS: ${{inputs.managed_workloads}}
        PLUGIN_CUSTOM_WORKLOADS: ${{inputs.custom_workloads}}
        PLUGIN_EXISTING_PODS: ${{inputs.existing_pods}}
        PLUGIN_MANIFEST_PATH: ${{inputs.manifest}}
        PLUGIN_LOG_LEVEL: ${{inputs.log_level}}
        PLUGIN_TIMEOUT: ${{inputs.timeout}}
        HARNESS_IS_OPENSHIFT: ${{inputs.is_openshift}}