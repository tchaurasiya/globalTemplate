template:
  inputs:
    connector:
      type: connector
      label: AWS Connector
      required: true
      default: ${{infra.connector}}
      oneof:
        - Aws
      ui:
        tooltip: Select the Harness AWS connector for the AWS account where you want to perform deployment
    region:
      type: string
      label: Region
      required: true
      default: ${{infra.region}}
      ui:
        component: string
        placeholder: us-east-1
        tooltip: Specify the AWS region for deployment
    log_level:
      type: string
      label: Log Level
      default: error
      options:
        - info
        - warn
        - error
        - debug
        - trace
      ui:
        component: select
        tooltip: Select the log level for the build step
    timeout:
      type: string
      label: Command timeout
      default: 10m
      ui:
        tooltip: Specify the timeout for the AWS build command
    docker_retry_count:
      type: number
      label: Docker retry count
      default: 10
      ui:
        component: string
        tooltip: Specify the number of retries to check if Docker is running (required for sam build --use-container)
    pre_exec_cmd:
      type: string
      label: Pre-execute command
      ui:
        component: string
        tooltip: Enter any necessary commands to execute before running the AWS SAM build
        placeholder: Enter a command to be executed prior to the command
    work_dir:
      type: string
      label: Working directory
      ui:
        component: string
        tooltip: Specify the AWS SAM working directory
        placeholder: /awssam/dir
    registry_url:
      type: string
      label: Docker Registry URL
      ui:
        component: string
        tooltip: Enter the Docker registry URL
        placeholder: Enter docker registry URL
    registry_username:
      type: string
      label: Docker Registry username
      ui:
        component: string
        tooltip: Enter the Docker registry username
        placeholder: Enter docker registry username
    registry_pwd:
      type: string
      label: Docker Registry password
      ui:
        component: secret-select
        tooltip: Select the Docker registry password
        placeholder: Select docker registry password
    path:
      type: string
      label: Template file path
      ui:
        component: string
        tooltip: Specify the AWS SAM template file path
        placeholder: /path/to/template/file
    cmd_opts:
      type: boolean
      label: Command options
      default: --use-container
      ui:
        component: string
        input:
          inputType: text
        tooltip: Enter additional command options for the build command
  layout:
    - connector
    - region
    - title: Optional Configuration
      items:
        - path
        - work_dir
        - pre_exec_cmd
        - timeout
        - cmd_opts
        - docker_retry_count
        - registry_url
        - registry_username
        - registry_pwd
        - log_level
  id: awsSamBuildStep
  name: AWS SAM Build Step
  description: Builds a package for deployment
  version: 1
  author: harness
  module:
    - cd
  alias: deploy
  step:
    group:
      steps:
        - name: Build
          id: build
          run:
            container:
              image: harnessdev/aws-sam-dev:0.0.12
              connector: account.harnessImage
            env:
              PLUGIN_HARNESS_CONNECTOR: ${{inputs.connector.id}}
              PLUGIN_LOG_LEVEL: ${{inputs.log_level}}
              PLUGIN_TIMEOUT: ${{inputs.timeout}}
              PLUGIN_DOCKER_RETRY_COUNT: ${{inputs.docker_retry_count}}
              PLUGIN_PRE_EXEC_CMD: ${{inputs.pre_exec_cmd}}
              PLUGIN_WORK_DIR: ${{inputs.work_dir}}
              PLUGIN_REGISTRY_URL: ${{inputs.registry_url}}
              PLUGIN_REGISTRY_USERNAME: ${{inputs.registry_username}}
              PLUGIN_REGISTRY_PWD: ${{inputs.registry_pwd}}
              PLUGIN_CMD_TYPE: build
              PLUGIN_TEMLATE_FILE_PATH: ${{inputs.path}}
              PLUGIN_CMD_OPTS: ${{inputs.cmd_opts}}