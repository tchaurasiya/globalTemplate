template:
  inputs:
    kubeconfig:
      type: string
      label: Kubeconfig Path
      default: ${{infra.PLUGIN_HARNESS_KUBE_CONFIG_PATH}}
      ui:
        tooltip: Enter the path to the 'kubeconfig' file.
    namespace:
      type: string
      label: Namespace
      default: ${{infra.namespace}}
      ui:
        tooltip: Enter the Kubernetes namespace for deployment
        placeholder: namespace
    select_delete_resources:
      type: select
      label: Delete Resources By
      default: resources
      options:
        - resources
        - manifests
        - release name        
    resources:
      type: array
      label: Resource Name
      ui:
        component: array
        input: 
          inputType: text
        tooltip: Enter a list of resources in format [ns/kind/name].
        placeholder: ns/kind/name
        visible: ${{selectDeleteResources == "resources"}}
    manifests:
      type: array
      label: Manifest Path
      ui:
        component: array
        input: 
          inputType: text
        tooltip: Enter a list of manifest file paths
        placeholder: path/manifest
        visible: ${{selectDeleteResources == "manifests"}}
    release:
      type: string
      label: Release Name
      default: ${{infra.release}}
      ui:
        tooltip: Enter the release name
        placeholder: release
        visible: ${{selectDeleteResources == "release name"}}
    delete_namespaces:
      type: boolean
      label: Delete namespace resources
      default: false
      ui:
        component: boolean-card-select
        tooltip: Include namespace resources in deletion process
        visible: ${{selectDeleteResources == "release name"}}
    flags:
      type: array
      label: Command Flags
      ui:
        component: list
        layout: grid
        inputs:
          - inputType: select
            relativePath: commandType
            label: Command Type
            inputConfig:
              options:
                - label: Delete
                  value: Delete
          - inputType: textarea
            relativePath: flag
            label: Flag
            ui:
              placeholder: --warnings-as-errors
    log_level:
      type: string
      label: Log Level
      default: info
      options:
        - warn
        - error
        - info
        - debug
        - trace
      ui:
        component: select
        tooltip: Select the log level for this step
    is_openshift:
      type: boolean
      label: OpenShift Mode
      default: false
      ui:
        component: boolean-card-select
        tooltip: Flag to mark if this is OpenShift deployment
  layout:
    - select_delete_resources
    - resources
    - manifests
    - release
    - title: Optional Configuration
      items:
        - kubeconfig
        - namespace
        - flags
        - log_level
        - delete_namespaces
        - is_openshift
  id: k8sDeleteStep
  name: Kubernetes Delete
  description: Deletes resources by name, manifest path, or release name.
  version: 1
  author: harness
  module:
    - cd
  alias: deploy
  step:
    name: Kubernetes Delete
    id: k8sDeleteStep
    run:
      container:
        image: harnessdev/k8s-delete:0.0.1
        connector: account.harnessImage
      env:
        PLUGIN_KUBECONFIG_PATH: ${{inputs.kubeconfig}}
        PLUGIN_RESOURCES: ${{inputs.resources}}
        PLUGIN_MANIFESTS: ${{inputs.manifests}}
        PLUGIN_RELEASE_NAME: ${{inputs.release}}
        PLUGIN_INCLUDE_NAMESPACES: ${{inputs.delete_namespaces}}
        PLUGIN_NAMESPACE: ${{inputs.namespace}}
        PLUGIN_FLAGS_JSON: ${{json.format(${{inputs.flags}})}}
        PLUGIN_LOG_LEVEL: ${{inputs.log_level}}
        HARNESS_IS_OPENSHIFT: ${{inputs.is_openshift}}