template:
  inputs:
    connector:
      type: connector
      label: GCP Connector
      required: true
      default: ${{infra.connector}}
      oneof:
        - Gcp
      ui:
        tooltip: Select the Harness GCP Connector for the GCP account where you want to perform deployment
        allowedValueTypes:
          - fixed
          - runtime
          - expression
    region:
      type: string
      label: GCP Region
      required: true
      default: ${{infra.region}}
      ui:
        component: string
        tooltip: Enter the GCP region where you want to run the job
    project:
      type: string
      label: GCP Project
      required: true
      default: ${{infra.project}}
      ui:
        component: string
        tooltip: Enter the GCP project where you want to run the job
    job:
      type: string
      label: Job Name
      ui:
        component: string
        tooltip: Enter the name of the job to run
        placeholder: sample-job-name
    manifest:
      type: string
      label: Job Manifest Path
      default: ${{service.manifests.gcr.paths}}
      ui:
        component: string
        tooltip: Specify the path where the job manifest is located on the shared volume
    replace_cmd_options:
      type: string
      label: Replace Command Options
      ui:
        component: string
        tooltip: Enter the options for the gcloud run jobs replace command
        placeholder: --async --verbosity=debug
    execute_cmd_options:
      type: string
      label: Execute Command Options
      ui:
        component: string
        tooltip: Enter the options for the gcloud run jobs execute command
        placeholder: --update-env-vars=key1=value1,key2=value2 --async
    cmd_timeout:
      type: string
      label: Command Timeout
      default: 10m
      ui:
        component: string
        tooltip: Specify the timeout for Google Cloud Run commands being executed
    log_level:
      type: string
      label: Log Level
      default: info
      options:
        - info
        - warn
        - error
        - debug
        - trace
      ui:
        component: select
  layout:
    - connector
    - region
    - project
    - title: Optional Configuration
      items:
        - job
        - manifest
        - replace_cmd_options
        - execute_cmd_options
        - cmd_timeout
        - log_level        
  id: GoogleCloudRunJobStep
  name: Google Cloud Run Job Step
  description: Execute Google Cloud Run job
  version: 1
  author: harness
  module:
    - cd
  alias: deploy
  step:
    group:
      steps:
        - name: Google Cloud Run Job
          id: googleCloudRunJob
          run:
            container:
              image: harnessdev/google-cloud-run-job:0.0.1
              connector: account.harnessImage
            env:
              PLUGIN_HARNESS_CONNECTOR: ${{inputs.connector.id}}
              PLUGIN_REGION: ${{inputs.region}}
              PLUGIN_PROJECT: ${{inputs.project}}
              PLUGIN_CMD_TIMEOUT: ${{inputs.cmd_timeout}}
              PLUGIN_LOG_LEVEL: ${{inputs.log_level}}
              PLUGIN_JOB: ${{inputs.job}}
              PLUGIN_MANIFEST_PATH: ${{inputs.manifest}}
              PLUGIN_REPLACE_CMD_OPTS: ${{inputs.replace_cmd_options}}
              PLUGIN_EXECUTE_CMD_OPTS: ${{inputs.execute_cmd_options}}
