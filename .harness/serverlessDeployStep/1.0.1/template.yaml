template:
  inputs:
    connector:
      type: connector
      label: AWS connector
      required: true
      default: ${{infra.connector}}
      oneof:
        - Aws
      ui:
        tooltip: Select the Harness AWS connector for the AWS account where you want to perform deployment.
    path:
      type: string
      label: Serverless.yaml path
      default: ${{service.manifests.serverlessAwsLambda.paths}}
      ui:
        component: string
        tooltip: Specify the path to the serverless custom manifest file.
        placeholder: /path/to/serverless.yaml
    work_dir:
      type: string
      label: Serverless directory
      ui:
        component: string
        tooltip: Specify the serverless working directory.
        placeholder: /serverless/dir
    region:
      type: string
      label: Region
      required: true
      default: ${{infra.region}}
      ui:
        component: string
        placeholder: us-east-1
        tooltip: Specify the AWS region.
    stack:
      type: boolean
      label: Get only stack details
      default: false
      ui:
        component: boolean-card-select
        tooltip: Enable to only perform retrieval of stack details without deployment.
    stage:
      type: string
      label: Stage
      required: true
      default: ${{infra.stage}}
      ui:
        component: string
        tooltip: Specify the serverless stage.
    client_path:
      type: string
      label: Serverless CLI path
      default: serverless
      ui:
        tooltip: Specify the path to the serverless CLI executable.
    timeout:
      type: string
      label: Command timeout
      default: 10m
      ui:
        tooltip: Specify the serverless CLI command timeout.
    cmd_opts:
      type: boolean
      label: Command options
      ui:
        component: string
        input:
          inputType: text
        tooltip: Specify command options.
        placeholder: Enter command options
    log_level:
      type: string
      label: Log level
      default: error
      options:
        - info
        - warn
        - error
        - debug
        - trace
      ui:
        component: select
        tooltip: Select the log level for the deploy step.
  layout:
    - connector
    - region
    - stage
    - title: Optional Configuration
      items:
        # Non-boolean fields first
        - path
        - work_dir
        - timeout
        - client_path
        - cmd_opts
        - log_level
        # Boolean fields grouped together
        - stack
  id: serverlessDeployStep
  name: Serverless Deploy Step
  description: Creates a package for deployment
  version: 1
  author: harness
  module:
    - cd
  alias: deploy
  step:
    group:
      steps:
        - name: Deploy
          id: deploy
          run:
            container:
              image: harnessdev/serverless-plugin:0.0.1-nodejs18.x-1.121-linux-amd64
              connector: account.harnessImage
            env:
              PLUGIN_HARNESS_CONNECTOR: ${{inputs.connector.id}}
              PLUGIN_LOG_LEVEL: ${{inputs.log_level}}
              PLUGIN_CMD_TYPE: deploy
              PLUGIN_SERVERLESS_FILE_PATH: ${{inputs.path}}
              PLUGIN_WORK_DIR: ${{inputs.work_dir}}
              PLUGIN_REGION: ${{inputs.region}}
              PLUGIN_GET_STACK_DETAILS: ${{inputs.stack}}
              PLUGIN_STAGE: ${{inputs.stage}}
              PLUGIN_SERVERLESS_EXEC_PATH: ${{inputs.client_path}}
              PLUGIN_TIMEOUT: ${{inputs.timeout}}
              PLUGIN_CMD_OPTS: ${{inputs.cmd_opts}}
