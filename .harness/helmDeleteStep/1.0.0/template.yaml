template:
  inputs:
    kubeconfig:
      type: string
      label: Kubeconfig Path
      default: ${{infra.PLUGIN_HARNESS_KUBE_CONFIG_PATH}}
      required: true
      ui:
        tooltip: Enter the path to the 'kubeconfig' file.
        placeholder: path/kubeconfig
    namespace:
      type: string
      label: Namespace
      required: true
      default: default
      ui:
        tooltip: Enter the Kubernetes namespace for deployment.
        placeholder: namespace
    release:
      type: string
      label: Release
      required: true
      ui:
        tooltip: Enter the name for the current Helm release.
    dry_run:
      type: boolean
      label: Dry Run
      default: false
      ui:
        component: boolean-card-select
        tooltip: Enable this option to execute as a dry run.
    deploy_flags:
      type: array
      label: Command Flags
      ui:
        component: list
        layout: grid
        inputs:
          - inputType: select
            relativePath: commandType
            label: Command Type
            inputConfig:
              options:
                - label: uninstall
                  value: uninstall
          - inputType: textarea
            relativePath: flag
            label: Flag
    deploy_env_vars:
      type: list
      label: Environment Variables
      ui:
        component: key-value-pairs
        tooltip: Enter environment variables to pass to the uninstall step.
    enforce_infra_namespace:
      type: boolean
      label: Enforce Namespace
      default: false
      ui:
        component: boolean-card-select
        tooltip: Enable this option to verify and enforce the namespace specified in the infrastructure configuration.
    deploy_log_level:
      type: string
      label: Log Level
      default: error
      options:
        - info
        - warn
        - error
        - debug
        - trace
      ui:
        component: select
        tooltip: Select the log level for the uninstall step.
  layout:
    - title: Optional Configuration
      items:
        - kubeconfig
        - namespace
        - release
        - deploy_log_level
        - deploy_flags
        - deploy_env_vars
        - dry_run
        - enforce_infra_namespace
  id: HelmDeleteStep
  name: Helm Delete
  description: Uninstalls a Helm release.
  version: 1
  author: harness
  module:
    - cd
  alias: deploy
  step:
    group:
      steps:
        - name: Helm Delete
          id: HelmDeleteStep
          run:
            container:
              image: harnessdev/helm-uninstall:linux-amd64-0.0.5
              connector: account.harnessImage
            env:
              PLUGIN_KUBECONFIG_PATH: ${{inputs.kubeconfig}}
              PLUGIN_NAMESPACE: ${{inputs.namespace}}
              PLUGIN_RELEASE_NAME: ${{inputs.release}} 
              PLUGIN_COMMAND_FLAGS: ${{json.format(${{inputs.deploy_flags}})}}
              PLUGIN_ENFORCE_INFRA_NAMESPACE: ${{inputs.enforce_infra_namespace}}
              PLUGIN_LOG_LEVEL: ${{inputs.deploy_log_level}}
              PLUGIN_DRY_RUN: ${{inputs.dry_run}}