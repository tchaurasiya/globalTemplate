template:
  inputs:
    kubeconfig:
      type: string
      label: Kubeconfig Path
      default: ${{infra.PLUGIN_HARNESS_KUBE_CONFIG_PATH}}
      ui:
        tooltip: Enter the path to the 'kubeconfig' file.
    namespace:
      type: string
      label: Namespace
      default: ${{infra.namespace}}
      ui:
        tooltip: Enter the Kubernetes namespace for deployment
        placeholder: default
    manifests:
      type: array
      label: Manifest Path
      default: ${{runtime.manifestPath}}
      ui:
        component: array
        input:
          inputType: text
        tooltip: Enter a list of manifest file paths
    release:
      type: string
      label: Release Name
      default: ${{infra.release}}
      ui:
        tooltip: Enter the name for the current Harness release
    flags:
      type: array
      label: Command Flags
      ui:
        component: list
        layout: grid
        inputs:
          - inputType: select
            relativePath: commandType
            label: Command Type
            inputConfig:
              options:
                - label: Diff
                  value: Diff
          - inputType: textarea
            relativePath: flag
            label: Flag
            ui:
              placeholder: --warnings-as-errors
    log_level:
      type: string
      label: Log Level
      default: info
      options:
        - warn
        - error
        - info
        - debug
        - trace
      ui:
        component: select
        tooltip: Select the log level for this step
    is_openshift:
      type: boolean
      label: OpenShift Mode
      default: false
      ui:
        component: boolean-card-select
        tooltip: Flag to mark if this is OpenShift deployment
    timeout:
      type: string
      label: Timeout
      default: 5m
      ui:
        tooltip: Enter the timeout to use during diff command execution
  layout:
    - title: Optional Configuration
      items:
        - kubeconfig
        - namespace
        - release
        - manifests
        - flags
        - timeout
        - log_level
        - is_openshift
  id: k8sDiffStep
  name: Kubernetes Diff
  description: Compares the current state of the cluster with the desired state defined in the manifests
  version: 1
  author: harness
  module:
    - cd
  alias: deploy
  step:
    name: Kubernetes Diff
    id: k8sDiffStep
    run:
      container:
        image: harnessdev/k8s-diff:0.0.1
        connector: account.harnessImage
      env:
        PLUGIN_KUBECONFIG_PATH: ${{inputs.kubeconfig}}
        PLUGIN_NAMESPACE: ${{inputs.namespace}}
        PLUGIN_MANIFESTS: ${{inputs.manifests}}
        PLUGIN_FLAGS_JSON: ${{json.format(${{inputs.flags}})}}
        PLUGIN_RELEASE_NAME: ${{inputs.release}}
        PLUGIN_TIMEOUT: ${{inputs.timeout}}
        HARNESS_IS_OPENSHIFT: ${{inputs.is_openshift}}
        PLUGIN_LOG_LEVEL: ${{inputs.log_level}}
