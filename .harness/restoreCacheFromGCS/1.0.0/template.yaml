template:
  inputs:
    connector:
      type: connector
      label: GCP Connector
      required: true
      oneof:
        - Gcp
      ui:
        tooltip: Select the Harness GCP Connector for the GCP account.
        allowedValueTypes:
          - fixed
          - runtime
          - expression
    cachekey:
      type: string
      label: Key
      required: true
      ui:
        component: string
        tooltip: Enter the key that can be used to restore this cache. You can use the checksum macro to create a key that is based on a file's checksum. For example, myApp-{ { checksum filePath1 } }.
        allowedValueTypes:
          - fixed
          - runtime
          - expression
    failIfKeyNotFound:
      type: boolean
      label: Fail If Key Doesnâ€™t Exist
      default: false
      ui:
        component: boolean-card-switch
        tooltip: Enable to fail the step if the key doesn't exist.
        allowedValueTypes:
          - fixed
          - runtime
          - expression
    bucket:
      type: string
      label: Bucket
      required: true
      ui:
        component: string
        tooltip: Enter the source GCS bucket name.
        allowedValueTypes:
          - fixed
          - runtime
          - expression
    archiveformat:
      type: string
      label: Archive Format
      default: tar
      items:
        - tar
        - gzip
        - zstd
      ui:
        tooltip: Select the archive format. The default format is tar.
        allowedValueTypes:
          - fixed
          - expression
    image:
      type: string
      label: Image
      default: plugins/cache
      ui:
        component: string
        tooltip: Specify the container image for the step.
        allowedValueTypes:
          - fixed
          - runtime
          - expression
  layout:
    - connector
    - bucket
    - cachekey
    - title: Optional Configuration
      items:
        - archiveformat
        - failIfKeyNotFound
        - image
  id: restoreCacheFromGCS
  name: Restore Cache from GCS
  description: Restore saved files and directories between builds using Google Cloud Storage (GCS).
  version: 1
  author: harness
  module:
    - ci
  alias: build
  step:
    group:
      steps:
        - name: restoreCacheGCS
          id: restoreCacheGCS
          run:
            container:
              image: ${{inputs.image}}
            with:
              CACHE_KEY: ${{inputs.cachekey}}
              RESTORE: true
              ARCHIVE_FORMAT: ${{inputs.archiveformat}}
              FAIL_RESTORE_IF_KEY_NOT_PRESENT: ${{inputs.failIfKeyNotFound}}
              EXIT_CODE: true
              BACKEND: gcs
              BACKEND_OPERATION_TIMEOUT: 7200000s
              BUCKET: ${{inputs.bucket}}
              JSON_KEY: ${{${{inputs.connector}}.jsonKey}}