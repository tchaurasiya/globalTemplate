template:
  inputs:
    log_level:
      type: string
      label: Log level
      default: "info"
      options:
        - info
        - debug
        - warning
        - error
      ui:
        component: select
        tooltip: Select the log level for the plugin execution
    
  layout:
    - log_level

  id: azureFunctionRollbackStep
  name: Azure Function Rollback Step
  description: Rollback Azure Function.
  version: 1
  author: harness
  module:
    - cd
  alias: rollback
  step:
    group:
      steps:
        - if: ${{artifact.repositoryFormat != "" && artifact.repositoryFormat != "docker"}}
          name: Download Artifact
          id: DownloadArtifact
          run:
            container:
              image:  harnessdev/artifact-download-plugin:0.0.14
              connector: account.harnessImage
            env:
              PLUGIN_ARTIFACT_ID: ${{rollback.artifacts.primary.id}}
        - name: Azure Function Rollback Step
          id: AzureFunctionRollbackStep
          run:
            container:
              image:  harnessdev/azure-function-plugin:0.0.1
              connector: account.harnessImage
            env:
              PLUGIN_LOG_LEVEL: ${{inputs.log_level}}
              PLUGIN_FUNCTION_NAME: ${{rollback.app}}
              PLUGIN_FUNCTION_SLOT: ${{rollback.slot}}
              PLUGIN_CMD_TYPE: rollback
              PLUGIN_DEPLOYMENT_TYPE: ${{rollback.deploy_type}}
              PLUGIN_ARTIFACT_TYPE: ${{rollback.source}}
              PLUGIN_SUBSCRIPTION_ID: ${{rollback.subscription_id}}
              PLUGIN_RESOURCE_GROUP: ${{rollback.resource_group}}            
              PLUGIN_CONTAINER_NAME: ${{rollback.image}} 
              PLUGIN_ACR_REGISTRY: ${{rollback.acr_name}}
              PLUGIN_ARTIFACT_PATH: ${{${{runtime.fqn}}.DownloadArtifact.output.outputVariables.PLUGIN_ARTIFACT_DOWNLOAD_PATH}}
              PLUGIN_HARNESS_CONNECTORx: ${{rollback.infra}}
              PLUGIN_ENV_VARS: ${{rollback.env_vars}}